<!-- 


                  Copyright (c)2000 monospace. All Rights Reserved.
 ______________________________________________________________________________
|                                                                              |
|                                  WARNING!                                    |
|                                                                              |
|                                                                              |
|        Use of this code without WRITTEN consent from the publisher is        |
|                   a violation of applicable Copyright Laws!                  |
|                                                                              |
|        Please contact scripts@monospace.com for licensing information.       |
|                                                                              |
|                                                                              |
|______________________________________________________________________________|
































































-->
<html>
<head>
	<title>controls</title>

<script><!--
// Copyright (c)2000 monospace. All Rights Reserved.



// preload images
back = new Image();
back.src = "deck/back.gif";
cards = new Array();
for (i=1; i<=52; i++){
	cards[i] = new Image(67,90);
	cards[i].src = "deck/" + i + ".gif";
}

// init suites and card names
names = "King,Ace,Two,Three,Four,Five,Six,Seven,Eight,Nine,Ten,Jack,Queen";
names = names.split(',');
suites = "Hearts,Spades,Diamonds,Clubs,Clubs";
suites = suites.split(',');

game = false; // game in progress

cash = 1000; // init cash
bet = 0; // init bet

shuffle(); // shuffle the deck
current = 0; // the current card

numbers = "0123456789";

function shuffle(){
	deck = new Array(52); // the shuffled deck
	temp = new Array(52); // flags for picked cards
	for (x=1; x<=52; x++){ // loop through the flags
		temp[x] = false; // set flags to false
	}	
	for (x=1; x<=52; x++){ // loop through the final deck
		r = Math.ceil(Math.random()*52); // pick a card
		if (!temp[r]){	// if this card is not yet picked
			temp[r] = true;	// now it is
			deck[x] = r; // put it in the final deck
		}else{ // if this card was already picked
			while (temp[r]){ // try again until we found one that's not yet picked
				r = Math.ceil(Math.random()*52); // pick a new card
			}
			temp[r] = true; // now this card is picked too
			deck[x] = r; // put it in the final deck
		}
	} // on to the next card
}

function deal(){
	writeMessage('');
	if (document.controls.betField.value == ''){
		writeMessage("Please enter the amount of your bet.");
		document.controls.betField.focus();
	}else{
		if (!game){
			if (getBet()){ 	// get a valid bet
				game = true; 	// start the game			
				playerPoints = 0
				dealerpoints = 0
				dealerHand = new Array(); // empty dealer's hand
				playerHand = new Array(); // empty player's hand
				for (i=0; i<=1; i++){
					playerHand[i] = nextCard(); // player gets first card
					dealerHand[i] = nextCard();
				}
				showPlayerCards();
				showDealerCards();
				resolve(); // see if there's an immediate blackjack
			}	
		}else{
			text = "There is currently a game in progress.\n";
			text += "Click \"Hit\" to get another card.\n";
			text += "Click \"Stand\" to end this round.";
			writeMessage(text);
		}
	}
}


function nextCard(){
	current++;
	if (current>52){
		lastCard = readCard(deck[52]);
		if (lastCard == readCard(dealerHand[1]) && game) lastCard = "Dealer\'s hole card";
		shuffle();
		current = 1;
		writeMessage("(New deck started after " + lastCard + ".)");
	}	
	return deck[current];
}

function changeBet(){
	if (game) {
		writeMessage("You can\'t change your bet while playing.")
		document.controls.betField.value = bet;
	}
}

function getBet(){
	bet = document.controls.betField.value;
	if (!isNumber(bet)){
		writeMessage("Please enter numbers only.");
		return false;
	}
	if (cash - bet < 0){
		writeMessage("Maximum bet exceeded.");
		return false;
	}else if (bet <= 0){
		writeMessage("Bet amount must be greater than zero.");
		return false;
	}else{
		//document.controls.cashField.value -= bet;
		return true;
	}
}

function isNumber(input){
	input = input.toString();
	for (var i=0; i<input.length; i++){
		if (numbers.indexOf(input.charAt(i)) == -1) return false;
	}
	return true;
}

function changeCash(){
	writeMessage("You can\'t change the amount of cash you have.\nIf you\'re broke, click \"Reset All\" to start over.");
	document.controls.cashField.value = cash;
}

function cashBalance(balance){
	cash += eval(balance);
	document.controls.cashField.value = cash;
	if (!document.controls.retain.checked) document.controls.betField.value = "";
	document.controls.betField.focus();
}

function readCard(cardNumber){
	suite = suites[Math.floor(cardNumber/13)];
	cardName = names[cardNumber % 13];
	return (cardName + " of " + suite);	 
}

function countPoints(hand){
	ace = 0;
	points = 0;
	for (i=0; i<hand.length; i++){
		n = readCard(hand[i]);
		if (n.indexOf("Ace") != -1) {points += 11; ace++;}
		if (n.indexOf("Two") != -1) points += 2;
		if (n.indexOf("Three") != -1) points += 3;
		if (n.indexOf("Four") != -1) points += 4;
		if (n.indexOf("Five") != -1) points += 5;
		if (n.indexOf("Six") != -1) points += 6;
		if (n.indexOf("Seven") != -1) points += 7;
		if (n.indexOf("Eight") != -1) points += 8;
		if (n.indexOf("Nine") != -1) points += 9;
		if (n.indexOf("Ten") != -1) points += 10;
		if (n.indexOf("Jack") != -1) points += 10;
		if (n.indexOf("Queen") != -1) points += 10;
		if (n.indexOf("King") != -1) points += 10;
	}
	if (points>21 && ace>0){
		for(i=1; i<=ace; i++){
			points -= 10;
			if (points <=21) break;
		}
	}
	return points;
}

function resolve(){	
	
	if (!game){ // game was ended (stand)
	 
		if (countPoints(playerHand) > 21){
			writeMessage("You lose.");
			cashBalance(-bet);
		}else if (countPoints(dealerHand) > 21){
			writeMessage("You win.");
			cashBalance(bet);
		}else if (countPoints(dealerHand) == countPoints(playerHand)){
			writeMessage("Push.");
			cashBalance(0);
		}else if (countPoints(dealerHand) > countPoints(playerHand)){
			writeMessage("You lose.");
			cashBalance(-bet);
		}else if (countPoints(dealerHand) < countPoints(playerHand)){
			writeMessage("You win.");
			cashBalance(bet);
		}
		
	}else{ // game still going
	
		// bust
		if (countPoints(playerHand) > 21){
			game = false;
			writeMessage("Bust.");
			cashBalance(-bet);
		}

		// immediate blackjack
		if (playerHand.length == 2 && countPoints(playerHand) == 21){ 
			game = false;
			// check dealer's cards
			while (countPoints(dealerHand)<17){ // dealer plays until over 17
				dealerHand[dealerHand.length] = nextCard();
			}
			showStandCards();
			if (countPoints(dealerHand)==21){ // dealer has 21 as well
				dealerAce = 0;
				for (i=1;i<dealerHand.length;i++){ // check dealer's hand for Ace
					dealerAce += (readCard(dealerHand[i]).indexOf('Ace') != -1) ? 1 : 0;
				}
				if (dealerAce > 0){ // dealer has Ace
					writeMessage("You win.");
					cashBalance(bet/2);
				}else{ // dealer has no Ace
					writeMessage("You lose.");
					cashBalance(-bet);
				}			
			}else{ // dealer does not have 21 
				writeMessage("You win.");
				cashBalance(bet/2);
			}
		}
		
		// other blackjack
		if (playerHand.length > 2 && countPoints(playerHand) == 21){
			// check dealer's cards
			game = false;
			while (countPoints(dealerHand)<17){ // dealer plays until over 17
				dealerHand[dealerHand.length] = nextCard();
			}
			showStandCards();
			if (countPoints(dealerHand) != 21){
				writeMessage("You win.");
				cashBalance(bet);
			}else{
				writeMessage("Push.");
			}
		}
	}
}

function insurance(){
	if (readCard(dealerHand[1]).indexOf('Ace') != -1){ // dealer shows an Ace
		if (confirm("The dealer has an Ace.\n Do you wish to purchase insurance?")){
	
		}else{
	
		}
	}
}

function hit(){
	if (game){
		playerHand[playerHand.length] = nextCard();
		showPlayerCards();
		resolve();
	}else{
		writeMessage("There is no game in progress.\nPlease click \"Deal\" first.");
	}
}

function stand(){
	if (game){
		game = false;
		while (countPoints(dealerHand)<17){ // dealer plays until over 17
			dealerHand[dealerHand.length] = nextCard();
		}
		showStandCards();
		resolve();
	}else{
		writeMessage("There is no game in progress.\nPlease click \"Deal\" first.");
	}
}


function doubleDown(){
	if (game){
		if (playerHand.length >2){
			writeMessage("You cannot double your bet on more than two cards.");
		}else{
			if (cash - (bet * 2) < 0){
				writeMessage("Maximum bet exceeded.");
			}else{
				bet *= 2;
				playerHand[playerHand.length] = nextCard();
				showPlayerCards();
				game = false;
				while (countPoints(dealerHand)<17){ // dealer plays until over 17
					dealerHand[dealerHand.length] = nextCard();
				}
				showStandCards();
				resolve();
				bet /= 2; 
			}
		}
	}else{
		writeMessage("There is no game in progress.\nPlease click \"Deal\" first.");
	}
}

function showRules(){
	rules = window.open('rules.html','pop',"width=400,height=400,toolbar=0,location=0,directories=0,status=1,menuBar=0,scrollBars=1,resizable=1");
	rules.focus();
}

function resetAll(){
	text = "This will end the current game and start over.";
	if (confirm(text)) parent.document.location.reload();
}


function showDealerCards(){
	parent.dealer.document.open();
	parent.dealer.document.write(markupStart()+'<font size=3><b>Dealer:</b><center>');
	parent.dealer.document.write('<img src=\"deck/' + dealerHand[0] + '.gif\" width=67 height=90 hspace=2>');
	parent.dealer.document.write('<img src=\"deck/back.gif\" width=67 height=90 hspace=2>')
	parent.dealer.document.write('</center></font>' + markupEnd());
	parent.dealer.document.close();
}

function showStandCards(){
	parent.dealer.document.open();
	parent.dealer.document.write(markupStart()+'<font size=3><b>Dealer:</b><center>');
	for (i=0; i<dealerHand.length; i++){
		parent.dealer.document.write('<img src=\"deck/' + dealerHand[i] + '.gif\" width=67 height=90 hspace=2>');
	}
	parent.dealer.document.write('<br><br><b>' + countPoints(dealerHand) + '</b>');
	parent.dealer.document.write('</center></font>' + markupEnd());
	parent.dealer.document.close();
}

function showPlayerCards(){
	parent.player.document.open();
	parent.player.document.write(markupStart()+'<font size=3><b>Player:</b><center>');
	for (i=0; i<playerHand.length; i++){
		parent.player.document.write('<img src=\"deck/' + playerHand[i] + '.gif\" width=67 height=90 hspace=2>');
	}
	parent.player.document.write('<br><br><b>' + countPoints(playerHand) + '</b>');
	parent.player.document.write('</center></font>' + markupEnd());
	parent.player.document.close();
}

function markupStart(){
	html = '<html><body bgcolor=008800 background="images/pat.gif"><font face="arial,helvetica">';
	return html;
}

function markupEnd(){
	html = '</font></body></html>';
	return html;
}

function writeMessage(msg){
	message = '<html><body bgcolor=008800 text=ffffff background="images/pat.gif"><center><font face=\"Arial, Helvetica\" size=\"-1\"><b>';
	message += msg;
	message += '</b></font></center></body></html>';
	parent.message.document.open();
	parent.message.document.write(message);
	parent.message.document.close();	
}

//--></script>

<style type="text/css">
input {font-family: arial,helvetica; font-weight:bold}
input.green {color:white; background-color:#008800; font-family: arial,helvetica; font-weight:bold}
</style>
</head>

<body bgcolor=008800 text=000000 background="images/pat.gif" onLoad="document.controls.betField.focus()">

<form name="controls" onSubmit="return false">
<table width=100% border=0 cellpadding=0 cellspacing=0>
	<tr valign=top>
		<td>
			<font face="arial, helvetica" size="-1">
			<input type="text" name="betField" value="" onKeypress="changeBet()">&nbsp;Bet<br>
			<input type="text" name="cashField" value="1000" onFocus="blur()">&nbsp;Cash<br>
			<input type="checkbox" name="retain">Keep Bet Amount<br>
			</font>
		</td>
		<td>
			<input class="green" type="button" value="Deal" onClick="deal()"><br>
		</td>
		<td>
			<input class="green" type="button" value="Hit" onClick="hit()"><br>
		</td>
		<td>
			<input class="green" type="button" value="Stand" onClick="stand()"><br>
		</td>
		<td>
			<input class="green" type="button" value="Double Down" onClick="doubleDown()"><br>
		</td>
		<td valign=bottom align=right>
			<input class="green" type="button" value="How to play..." onClick="showRules()">&nbsp;&nbsp;
			<input class="green" type="button" value="Reset All" onClick="resetAll()">
		</td>
	</tr>
</table>
</form>

</body>

</html>
